U-0108 — Codex Prompt

You are working in the repo root.

Ticket: U-0108 — Web User: Search Results UX upgrade (MVP)

Goal
•	Improve the /search experience in the web-user app (Vite + React + TS):
•	Better results layout (book cards + compact list option)
•	Loading / empty / error states
•	Query + filters reflected in URL (at minimum: q, size, vector)
•	Result click navigates to /book/:docId and preserves the selected item payload for the detail page
•	Keep dependencies minimal: use existing libs already in package.json (React, React Router, Bootstrap). Do not add new UI kits or state libs.

Constraints
•	Do NOT modify backend services.
•	Do NOT modify contracts.
•	Do NOT add authentication.
•	Do NOT introduce Redux/Zustand/etc.
•	Only touch web-user code under: apps/web_user/** (and optionally root docs if explicitly allowed).
•	If there are unrelated git changes outside apps/web_user, do not include them in the commit.

Must Read (SSOT)
•	AGENTS.md (repo rules)
•	apps/web_user/README.md (if present)
•	Current implementation from U-0106 (AppShell/router)
•	Current Search page from U-0107 (Query → Search flow)

Scope (Allowed)
•	apps/web_user/**

Scope (Forbidden)
•	services/**
•	contracts/**
•	infra/**
•	db/**
•	apps/web_admin/**

Implementation Requirements
1.	Search page UX

	•	File: apps/web_user/src/pages/SearchPage.tsx (or your current path)
	•	Behavior:
	•	Read q from URL querystring and auto-run search when q is non-empty.
	•	Provide a “Search” form (can reuse header search, but page should work on direct URL visits).
	•	Support these URL params (MVP):
	•	q (string)
	•	size (number, default 10, clamp 1..50)
	•	vector (boolean, default true)
	•	Ensure UI controls update the URL params (so refresh/share works).

	2.	Results presentation

	•	Implement a clean list of hits using Bootstrap:
	•	Each result shows: title, authors, publisher, issued_year, volume, edition_labels
	•	Show a “score” badge and optionally key debug fields when debug is enabled.
	•	Add a view toggle (MVP):
	•	Card view (default): card per book
	•	Compact view: tighter rows
	•	This can be a simple button group and can be local state (no need to store in URL).

	3.	Loading / Empty / Error states

	•	Loading:
	•	Show a skeleton-ish placeholder or spinner (simple is fine).
	•	Empty:
	•	If hits length == 0, show a friendly empty message and example queries.
	•	Error:
	•	Show an alert with status + message.
	•	If backend error returns JSON {error:{code,message}}, render it.

	4.	Debug mode (MVP)

	•	Add a debug checkbox on the page (default false).
	•	If debug is enabled:
	•	Send options.debug=true to Search Service.
	•	Render top-level debug block with:
	•	strategy, took_ms, ranking_applied
	•	debug.stages, debug.applied_fallback_id, debug.query_text_source_used
	•	Render per-hit debug (lex_rank, vec_rank, rrf_score, ranking_score) if present.

	5.	Click-through to Book Detail

	•	On clicking a result:
	•	Navigate to /book/:docId
	•	Preserve minimal selected payload (MVP) for the detail page:
	•	Use sessionStorage key like: bsl:lastHit:<docId>
	•	Store JSON of { doc_id, source, debug, fromQuery, ts }
	•	BookDetail page (if exists from U-0106):
	•	On load, try to read that sessionStorage payload and display it.
	•	If not found, display “No cached payload; go back to search.” (API fetch comes later tickets.)

	6.	API wiring

	•	Use the same environment variables:
	•	VITE_QUERY_BASE_URL=http://localhost:8001
	•	VITE_SEARCH_BASE_URL=http://localhost:8080
	•	Reuse/extend any existing api.ts helper you created in U-0107:
	•	fetch JSON
	•	AbortController timeout (e.g., 5s)
	•	Return structured errors

	7.	Styling

	•	Keep styling lightweight:
	•	Use Bootstrap spacing utilities and small custom CSS if needed:
	•	apps/web_user/src/styles/app.css (or equivalent)
	•	Ensure it looks acceptable on mobile:
	•	Filters and toggles should wrap nicely.

Run instructions / Validation
•	cd apps/web_user
•	npm install
•	cp .env.example .env (if needed)
•	npm run dev -- --port 5174

Manual checks (Done when)
1.	Visit /search?q=해리
•	Auto-runs and shows results
2.	Toggle vector off (vector=false in URL)
•	Re-runs and shows results
3.	Toggle debug on
•	Debug block appears and request sends debug=true
4.	Click a result
•	Goes to /book/b1 (or docId)
•	Detail page shows cached payload from sessionStorage
5.	Refresh /search?q=해리&size=5&vector=true
•	State is preserved via URL

Deliverables
•	List changed/created files
•	How to run locally
•	Notes/TODOs (e.g., real BookDetail fetch in next ticket)

Important
•	Do not change tasks/** files or other unrelated directories. If you see unrelated changes, leave them uncommitted and proceed only with apps/web_user changes.
