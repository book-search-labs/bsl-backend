Ticket: U-0110 — Web User: Search E2E via Query Service (qc.v1.1) → Search Service (/search)

Goal
- Wire apps/web-user so the search flow uses the real backend pipeline:
  Web User → Query Service (/query-context, qc.v1.1) → Search Service (/search, query_context_v1_1) → Results
- Reuse existing UI from U-0108 (results) and U-0109 (book detail via sessionStorage).
- Add a lightweight debug toggle to show strategy/took_ms and (optional) debug fields.

Constraints
- Do NOT modify backend services.
- Do NOT modify apps/web-admin.
- Keep dependencies minimal; do not add new packages unless absolutely necessary.

Scope
- Allowed: apps/web-user/**
- Forbidden: services/**, contracts/**, infra/**, db/**, apps/web-admin/**

Must Read (SSOT)
- apps/web-user/README.md (or create/update minimal run instructions if missing)
- apps/web-user/.env.example (must exist after this ticket)
- Existing pages/components from U-0106/0107/0108/0109

Environment (ports are fixed)
- web-admin: 5173 (do not touch here)
- web-user: 5174
- Query Service: http://localhost:8001
- Search Service: http://localhost:8080

Required env vars (web-user)
- apps/web-user/.env.example must include:
  VITE_QUERY_BASE_URL=http://localhost:8001
  VITE_SEARCH_BASE_URL=http://localhost:8080
- Ensure .env is gitignored (root .gitignore or apps/web-user/.gitignore)

Implementation Requirements

1) Add a tiny API layer (no new deps)
   Create:
- apps/web-user/src/api/http.ts
  - export async function fetchJson<T>(url: string, init?: RequestInit): Promise<T>
  - Set JSON headers, JSON stringify body if object
  - If response is non-2xx:
    - read text, try JSON parse
    - throw Error subclass (or typed object) with status + parsed body/snippet

- apps/web-user/src/api/queryService.ts
  - export async function postQueryContext(rawQuery: string): Promise<any>
  - POST {import.meta.env.VITE_QUERY_BASE_URL}/query-context
  - body: { "query": { "raw": rawQuery }, "client": { "device": "web_user" }, "user": null }
  - Accept server-generated traceId/requestId (no need to generate client-side)

- apps/web-user/src/api/searchService.ts
  - export type SearchOptions = { size: number; from: number; debug?: boolean }
  - export async function postSearchWithQc(qc: any, options: SearchOptions): Promise<any>
  - POST {import.meta.env.VITE_SEARCH_BASE_URL}/search
  - body: { "query_context_v1_1": qc, "options": options }

2) Update SearchPage to run E2E automatically
   In apps/web-user/src/pages/SearchPage.tsx (or your current search container):
- Read q from URL: /search?q=...
- On first mount and when q changes:
  - if q is non-empty, run search once (avoid infinite loops)
- On submit from header search (already navigates), this page should pick up q and run.

Pipeline:
- set loading true
- qc = await postQueryContext(q)
- If debug toggle is off, send options.debug=false; if on, options.debug=true
- res = await postSearchWithQc(qc, { size, from: 0, debug })
- render results using existing U-0108 list UI
- store last qc + response in state for debug panel

Vector toggle (MVP)
- Add a checkbox "Vector" default true.
- If unchecked, before calling search mutate:
  qc.retrievalHints.vector.enabled = false (create missing objects safely)

Error handling
- show inline alert with status + message
- show "Retry" button that reruns the same q
- do not crash on malformed error body

3) Keep BookDetail navigation consistent with U-0109
- Ensure clicking a hit navigates to:
  /book/:docId  (NOT /books/:docId)
- When a hit is clicked, keep the existing sessionStorage behavior from U-0109
  (store the selected hit/source for the detail page).
- Do NOT add a new backend call for book detail in this ticket.

4) Debug toggle UI
- Add "Debug" checkbox default off
- When on:
  - send options.debug=true
  - show a small panel with:
    - strategy, took_ms, trace_id, request_id
    - if present: response.debug.stages, response.debug.applied_fallback_id, response.debug.query_text_source_used
- When off:
  - hide the panel (but still can show strategy/took_ms subtly if you prefer)

5) README / run instructions
   Update or create apps/web-user/README.md with:
- npm install
- cp .env.example .env
- npm run dev -- --port 5174

Acceptance (manual)
1) Start Query Service on 8001 and Search Service on 8080 (OpenSearch seeded already).
2) Run web-user on 5174.
3) Visit http://localhost:5174/search?q=해리
  - should auto-run and show results
  - default strategy should be hybrid_rrf_v1_1 when vector enabled
4) Toggle Vector off and rerun -> strategy bm25_v1_1
5) Toggle Debug on -> see trace/request ids and stages/debug
6) Click a result -> navigates to /book/<docId> and shows stored detail content
7) Back returns to /search?q=해리

Deliverables
- Provide a short summary of changed/created files
- Provide how to run locally commands
