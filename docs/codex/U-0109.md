U-0109 — Codex Prompt

You are working in the repo root.

Ticket: U-0109 — Web User: Book Detail page + recent views (sessionStorage) (MVP)

Goal
•	Implement a usable Book Detail page for the web-user app at route: /book/:docId
•	Store and show recently viewed books using sessionStorage
•	Keep dependencies minimal (use existing stack: React + TS + React Router + Bootstrap). No new state libs.

Constraints
•	Do NOT modify backend services.
•	Do NOT add auth, checkout, or payments.
•	Use environment variables via Vite:
•	VITE_SEARCH_BASE_URL=http://localhost:8080
•	VITE_QUERY_BASE_URL=http://localhost:8001

Scope
•	Only change apps/web_user/** (or your web-user folder).
•	Do not touch unrelated tasks/** files (if they show up in git status, ignore/revert them).

⸻

Requirements

1) Search API client (shared helper)
   Create or update a small fetch helper:
   •	src/api/searchApi.ts (or src/api/http.ts + src/api/searchApi.ts)
   •	Must support:
   •	searchByDocId(docId: string): Promise<Book | null>
   •	search(query: string, opts?): Promise<SearchResponse> (if already exists from U-0108/U-0110, reuse)

Implementation for searchByDocId:
•	Call Search Service /search with a minimal request:

{
"query": { "raw": "<docId>" },
"options": { "size": 5, "from": 0, "enableVector": false }
}

	•	Then, in client code:
	•	Find the best matching hit by:
	1.	exact hit.doc_id === docId if present, else
	2.	first hit.
	•	Return a normalized Book object:
	•	docId, titleKo, authors[], publisherName, issuedYear, volume, editionLabels[]
	•	Handle errors gracefully; return null on 404-like/empty results.

Note: We don’t have a dedicated /books/:id endpoint yet. This ticket uses /search as a workaround.

2) BookDetailPage UI
   Update src/pages/BookDetailPage.tsx:
   •	Read docId from useParams()
   •	Show:
   •	Title
   •	Authors
   •	Publisher / year / volume
   •	Edition labels chips (if any)
   •	Add actions:
   •	“Back to results” button:
   •	If URL has ?from=search, navigate back to /search?q=<lastQuery> if available, else /search
   •	“Search similar” button:
   •	navigate to /search?q=<title>
   •	Loading / error states:
   •	skeleton/placeholder while loading
   •	friendly message if book not found

3) Recently viewed (sessionStorage)
   Implement a small module:
   •	src/utils/recentViews.ts
   •	Store an array in sessionStorage key: bsl.recentViews
   •	Each item:

type RecentView = {
docId: string
titleKo: string | null
authors: string[]
viewedAt: number
}

Rules:
•	On successful book load, upsert to front (most recent first)
•	De-duplicate by docId
•	Max size: 10
•	Provide functions:
•	getRecentViews(): RecentView[]
•	addRecentView(view: RecentView): void
•	clearRecentViews(): void

4) Show “Recently viewed” section
   Add a section on:
   •	HomePage (preferred) OR SearchPage
   •	Show up to 5 items:
   •	Title + author
   •	Clicking goes to /book/:docId?from=recent
   •	Add “Clear” button.

5) Routing consistency
   Ensure /book/:docId route exists and works.
   If NotFoundPage exists, keep it.

6) Styling
   Use Bootstrap components:
   •	Card, ListGroup, Badge, Buttons
   •	Mobile friendly layout

⸻

Run instructions (update README)

Update apps/web_user/README.md (create if missing):
•	npm install
•	cp .env.example .env
•	npm run dev -- --port 5174

Also ensure .env.example exists in apps/web_user and includes:
•	VITE_SEARCH_BASE_URL=http://localhost:8080
•	VITE_QUERY_BASE_URL=http://localhost:8001

⸻

Acceptance
•	npm run dev works
•	Visiting /book/b1 shows a detail page (based on search response)
•	After visiting 2–3 books, Home (or Search) shows “Recently viewed”
•	Recent list persists across refresh in the same browser session (sessionStorage)
•	No new dependencies added

Deliverables
•	List changed/created files
•	How to run locally
