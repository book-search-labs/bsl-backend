server:
  port: ${SEARCH_PORT:8080}

spring:
  application:
    name: search-service

opensearch:
  base-url: ${OPENSEARCH_URL:http://localhost:9200}
  doc-index: ${OPENSEARCH_DOC_INDEX:books_doc_read}
  vec-index: ${OPENSEARCH_VEC_INDEX:books_vec_read}
  connect-timeout-ms: ${OPENSEARCH_CONNECT_TIMEOUT_MS:200}
  read-timeout-ms: ${OPENSEARCH_READ_TIMEOUT_MS:200}

ranking:
  base-url: ${RANKING_BASE_URL:http://localhost:8082}
  timeout-ms: ${RANKING_TIMEOUT_MS:200}

embedding:
  mode: ${EMBEDDING_MODE:TOY}
  base-url: ${EMBEDDING_BASE_URL:http://localhost:8005}
  model: ${EMBEDDING_MODEL:}
  timeout-ms: ${EMBEDDING_TIMEOUT_MS:200}

search:
  experiments:
    enabled: ${SEARCH_EXPERIMENTS_ENABLED:false}
    explore-rate: ${SEARCH_EXPERIMENT_EXPLORE_RATE:0.01}
    shuffle-start: ${SEARCH_EXPERIMENT_SHUFFLE_START:5}
    shuffle-end: ${SEARCH_EXPERIMENT_SHUFFLE_END:20}
    min-results: ${SEARCH_EXPERIMENT_MIN_RESULTS:20}
    min-query-length: ${SEARCH_EXPERIMENT_MIN_QUERY_LENGTH:2}
    exclude-isbn: ${SEARCH_EXPERIMENT_EXCLUDE_ISBN:true}
    exclude-quoted: ${SEARCH_EXPERIMENT_EXCLUDE_QUOTED:true}
  execution:
    pool-size: ${SEARCH_EXEC_POOL_SIZE:6}
  vector:
    mode: ${SEARCH_VECTOR_MODE:EMBEDDING}
    model-id: ${SEARCH_VECTOR_MODEL_ID:}
  resilience:
    vector-failure-threshold: ${SEARCH_VECTOR_FAIL_THRESHOLD:3}
    vector-open-ms: ${SEARCH_VECTOR_OPEN_MS:30000}
    rerank-failure-threshold: ${SEARCH_RERANK_FAIL_THRESHOLD:3}
    rerank-open-ms: ${SEARCH_RERANK_OPEN_MS:30000}
    rerank-hedge-delay-ms: ${SEARCH_RERANK_HEDGE_DELAY_MS:60}
  cache:
    serp:
      enabled: ${SEARCH_SERP_CACHE_ENABLED:true}
      ttl-ms: ${SEARCH_SERP_CACHE_TTL_MS:2000}
      max-entries: ${SEARCH_SERP_CACHE_MAX:500}
      key-prefix: ${SEARCH_SERP_CACHE_PREFIX:serp:}
    book:
      enabled: ${SEARCH_BOOK_CACHE_ENABLED:true}
      ttl-ms: ${SEARCH_BOOK_CACHE_TTL_MS:60000}
      max-entries: ${SEARCH_BOOK_CACHE_MAX:2000}
      key-prefix: ${SEARCH_BOOK_CACHE_PREFIX:book:}
      cache-control-max-age-seconds: ${SEARCH_BOOK_CACHE_MAX_AGE_SECONDS:60}

app:
  cors:
    allowed-origins: ${CORS_ALLOW_ORIGINS:http://localhost:4173,http://localhost:5173,http://localhost:5174}
    allowed-methods: ${CORS_ALLOW_METHODS:GET,POST,PUT,PATCH,DELETE,OPTIONS}
    allowed-headers: ${CORS_ALLOW_HEADERS:*}
    exposed-headers: ${CORS_EXPOSED_HEADERS:x-trace-id,x-request-id}
    allow-credentials: ${CORS_ALLOW_CREDENTIALS:true}


logging:
  level:
    root: ${LOG_LEVEL:DEBUG}
